<!DOCTYPE html>
<html>
<head>
  <title>PM - DEV</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <form accept-charset="UTF-8" action="/charts/cholesterol/intervention" data-remote="true" method="post" id="intervention-data">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel"></h4>
        </div>
        <div class="modal-body">
            <div class="row">
              <div class="col-xs-8 col-xs-offset-1">
                <div class="col-sm-4">
                  <label for="intervention[title]" class="pull-right">Medication</label>
                </div>
                <div class="col-sm-8">
                  <div class="form-group">
                    <input type="text" class="form-control" name="intervention[title]" placeholder="(ie: Crestor, Simcor...)">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-8 col-xs-offset-1">
                <div class="col-sm-4">
                  <label for="intervention[dose]" class="pull-right">Dose</label>
                </div>
                <div class="col-sm-8">
                  <div class="form-group">
                    <input type="text" class="form-control" name="intervention[dose]" placeholder="(ie: 40mg, 20mg...)">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="form-group col-sm-4 col-sm-offset-1">
                <label for="intervention[start]">Start date</label>
                <input type="date" class="form-control" name="intervention[start]">
              </div>
              <div class="form-group col-sm-4 col-sm-offset-2">
                <label for="intervention[end]">End date</label>
                <input type="date" class="form-control" name="intervention[end]">
              </div>
            </div>
            <div class="row">
              <a href="#" class="btn btn-link pull-right">Click to add more medication</a>
            </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Save</button>
        </div>
      </div>
    </form>
  </div>
</div>
<%= yield %>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script>
$.ajaxSetup({
  headers: {
    'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
  }
});
  function createRow(index){
    // console.log(row.replace('index', parseInt(index)+1))
    return '<tr><td>'+(parseInt(index)+1)+'</td><td><input type="date" name="entry[date['+(parseInt(index)+1)+']]"></td><td><input type="text" name="entry[ldl['+(parseInt(index)+1)+']]"></td><td><input type="text" name="entry[hdl['+(parseInt(index)+1)+']]"></td><td><input type="text" name="entry[triglycerides['+(parseInt(index)+1)+']]"></td><td><input type="text" name="entry[cholesterol['+(parseInt(index)+1)+']]"></td></tr>';
  }
  $('button.random').on('click', function(e){
    e.preventDefault();
    $('div.manual-input table.cholesterol-data input[type=text]').each(function(k,v){
      $(this).val(1 + Math.floor(Math.random() * 150));
    });
    $('div.manual-input table.cholesterol-data input[type=date]').each(function(k,v){
      $(this).val((2010+k).toString() + '-' +'01' + '-' +'01');
    });
  });
  $('div.manual-input button.add-row').on('click', function(e){
    e.preventDefault();
    var currentIndex = $('div.manual-input table.cholesterol-data tr:last td:first').text();
    $('div.manual-input table.cholesterol-data tbody').append(createRow(currentIndex));
  });
  $('div.copy-paste-input button.add-row').on('click', function(e){
    e.preventDefault();
    var currentIndex = $('div.copy-paste-input table.copy-paste-data tr:last td:first').text();
    $('div.copy-paste-input table.copy-paste-data tbody').append(createRow(currentIndex));
  });
  $('button.activate-copy-paste').on('click', function(e){
    e.preventDefault();
    $('.manual-input, .copy-paste-input, .manual-mode, .copy-paste-mode').toggleClass('hide');
    $('#dataInput').focus();
  });
  $('button.start-over').on('click', function(e){
    e.preventDefault();
    $('.start-over-mode, .manual-input, .copy-paste-input, .copy-paste-mode').toggleClass('hide');
    $('div.manual-input table.cholesterol-data').removeClass('hide');
    $('div.manual-input table.cholesterol-data input').val('').attr("placeholder", '').find("tr:gt(4)").remove();;
  });

  // $('input[type=date].pasted').each(function(k,v){
  //   var date = $(this).attr("placeholder");
  //   $(this).val(date);
  // });
  $('.session-entry-values').each(function(k,v){
    var value = $(this).attr("placeholder");
    $(this).val(value);
  });

  $('#add-intervention').change(function(e){
    var title = $(this).val();
    $('#myModal').modal('show');
    $('#myModal').on('shown.bs.modal', function () {
      $('#myInput').focus();
      var modal = $(this);
      modal.find('.modal-title').text(title);
    });
  });

$('#myModal').on('hidden.bs.modal', function (e) {
  $('#add-intervention').removeAttr('selected').prop('selectedIndex',0);
})

  // $('#intervention-data').bind('ajax:complete', function(e){
  //   $('#myModal').modal('hide');
  //   updateData();
  // });



// console.log("1\t06/25/14\t->\t"+ multiDateParser('06/25/14'));
// console.log("2\t06/25/2014\t->\t"+ multiDateParser('06/25/2014'));
// console.log("3\t06-25-14\t->\t"+ multiDateParser('06-25-14'));
// console.log("4\t06-25-2014\t->\t"+ multiDateParser('06-25-2014'));
// console.log("5\t6/5/14\t->\t"+ multiDateParser('6/5/14'));
// console.log("6\t6/5/2014\t->\t"+ multiDateParser('6/5/2014'));
// console.log("7\t6/05/14\t->\t"+ multiDateParser('6/05/14'));
// console.log("8\t6/05/2014\t->\t"+ multiDateParser('6/05/2014'));
// console.log("9\t06/5/14\t->\t"+ multiDateParser('06/5/14'));
// console.log("10\t06/5/2014\t->\t"+ multiDateParser('06/5/2014'));
// console.log("11\t6-5-14\t->\t"+ multiDateParser('6-5-14'));
// console.log("12\t6-5-2014\t->\t"+ multiDateParser('6-5-2014'));
// console.log("13\t6-05-14\t->\t"+ multiDateParser('6-05-14'));
// console.log("14\t6-05-2014\t->\t"+ multiDateParser('6-05-2014'));
// console.log("15\t06-5-14\t->\t"+ multiDateParser('06-5-14'));
// console.log("16\t06-5-2014\t->\t"+ multiDateParser('06-5-2014'));
// console.log("17\tJune 25th, 2014\t->\t"+ multiDateParser('June 25th, 2014'));
// console.log("18\tJune 25th, 14\t->\t"+ multiDateParser('June 25th, 14'));
// console.log("19\tJune 25th 2014\t->\t"+ multiDateParser('June 25th 2014'));
// console.log("20\tJune 25th 14\t->\t"+ multiDateParser('June 25th 14'));
// console.log("21\tJune 25, 14\t->\t"+ multiDateParser('June 25, 14'));
// console.log("22\tJune 25, 2014\t->\t"+ multiDateParser('June 25, 2014'));
// console.log("23\tJune 25 14\t->\t"+ multiDateParser('June 25 14'));
// console.log("24\tJune 25 2014\t->\t"+ multiDateParser('June 25 2014'));
// console.log("25\tJune 5th, 2014\t->\t"+ multiDateParser('June 5th, 2014'));
// console.log("26\tJune 5th, 14\t->\t"+ multiDateParser('June 5th, 14'));
// console.log("27\tJune 5th 2014\t->\t"+ multiDateParser('June 5th 2014'));
// console.log("28\tJune 5th 14\t->\t"+ multiDateParser('June 5th 14'));
// console.log("29\tJune 5, 14\t->\t"+ multiDateParser('June 5, 14'));
// console.log("30\tJune 5, 2014\t->\t"+ multiDateParser('June 5, 2014'));
// console.log("31\tJune 5 14\t->\t"+ multiDateParser('June 5 14'));
// console.log("32\tJune 5 2014\t->\t"+ multiDateParser('June 5 2014'));

// console.log('June 25th, 14'.indexOf("th"));
// console.log('June 25th, 14'.indexOf(","));

</script>
</body>
</html>
